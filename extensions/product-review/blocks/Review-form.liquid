<!-- Star Rating section with Review Form -->
<div class="star-rating-section">
  <h2 class="star-rating-section__title">Customer Ratings</h2>

  <!-- List of Reviews -->
  <ul class="star-rating-list">
    {% assign reviews = shop.metafields.custom.reviews %}
    {% if reviews and reviews.size > 0 %}
      {% for review in reviews %}
        <li class="star-rating-item">
          <h3 class="star-rating-item__title">{{ review.title }}</h3>
          <p class="star-rating-item__content">{{ review.content }}</p>
          <div class="star-rating-item__stars">
            {% for i in (1..5) %}
              {% if review.rating >= i %}
                <span class="star filled">&#9733;</span>
              {% else %}
                <span class="star">&#9734;</span>
              {% endif %}
            {% endfor %}
          </div>
          <p class="star-rating-item__author"><strong>Author:</strong> {{ review.author }}</p>
        </li>
      {% endfor %}
    {% else %}
      <p class="star-rating-section__no-reviews">No reviews yet. Be the first to review!</p>
    {% endif %}
  </ul>

  <!-- Button to Open Form -->
  <button class="open-review-form-btn">Write a Review</button>

  <!-- Review Form -->
  <div class="review-form" style="display: none;">
    <h2 class="review-form__title">Write a Review</h2>
    <form id="reviewForm" action="/submit_review" method="POST">
      <div class="form-group">
        <label for="review-title">Title</label>
        <input type="text" id="review-title" name="review[title]" required>
      </div>

      <div class="form-group">
        <label for="review-content">Review</label>
        <textarea id="review-content" name="review[content]" rows="6" required></textarea>
      </div>

      <div class="form-group">
        <label for="review-rating">Rating</label>
        <div class="star-rating-input">
          {% for i in (1..5) %}
            <input type="radio" id="star{{ i }}" name="review[rating]" value="{{ i }}" required>
            <label for="star{{ i }}" title="{{ i }} stars">&#9733;</label>
          {% endfor %}
        </div>
      </div>

      <div class="form-group">
        <label for="review-author">Your Name</label>
        <input type="text" id="review-author" name="review[author]" required>
      </div>

      <button type="submit" class="btn-submit-review">Submit Review</button>
    </form>
    <button class="close-review-form-btn">X</button>
  </div>
</div>

<style>
  .star-rating-section {
    padding: 20px;
    margin-top: 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .star-rating-section__title {
    font-size: 1.5em;
    margin-bottom: 15px;
  }

  .star-rating-list {
    list-style-type: none;
    padding: 0;
  }

  .star-rating-item {
    margin-bottom: 20px;
  }

  .star-rating-item__title {
    font-size: 1.2em;
    margin: 0 0 5px;
  }

  .star-rating-item__content {
    margin: 0 0 10px;
  }

  .star-rating-item__stars {
    display: flex;
    flex-direction: row; /* Align stars horizontally */
    gap: 5px;
  }

  .star {
    font-size: 1.5em;
    color: #ccc;
  }

  .star.filled {
    color: gold;
  }

  .open-review-form-btn {
    background-color: #000000;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s ease, transform 0.3s ease;
    margin-bottom: 20px;
  }

  .open-review-form-btn:hover {
    background-color: #0056b3;
    transform: translateY(-2px);
  }

  .review-form {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
    transition: opacity 0.5s ease, transform 0.5s ease;
    display: none;
    opacity: 0;
    transform: translateY(-20px);
  }

  .review-form.show {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }

  .review-form.hide {
    opacity: 0;
    transform: translateY(-20px);
  }

  .review-form__title {
    font-size: 1.5em;
    margin-bottom: 15px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }

  .form-group input[type="text"],
  .form-group textarea {
    width: calc(100% - 20px);
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1em;
    resize: vertical;
  }

  .form-group input[type="text"]:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
  }

  .star-rating-input {
    display: flex;
    gap: 5px;
  }

  .star-rating-input input[type="radio"] {
    display: none;
  }

  .star-rating-input label {
    font-size: 1.5em;
    color: #ccc;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  .star-rating-input label:hover,
  .star-rating-input input[type="radio"]:checked ~ label {
    color: gold;
  }

  .btn-submit-review {
    background-color: #28a745;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s ease, transform 0.3s ease;
  }

  .btn-submit-review:hover {
    background-color: #218838;
    transform: translateY(-2px);
  }

  .close-review-form-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #dc3545;
    color: white;
    padding: 5px 10px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 0.9em;
    transition: background-color 0.3s ease, transform 0.3s ease;
  }

  .close-review-form-btn:hover {
    background-color: #c82333;
    transform: translateY(-2px);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const openFormBtn = document.querySelector('.open-review-form-btn');
    const reviewForm = document.querySelector('.review-form');
    const closeFormBtn = document.querySelector('.close-review-form-btn');
    const formElement = document.getElementById('reviewForm');

    openFormBtn.addEventListener('click', function() {
      reviewForm.style.display = 'block';
      requestAnimationFrame(() => {
        reviewForm.classList.add('show');
        reviewForm.classList.remove('hide');
      });
      openFormBtn.style.display = 'none'; // Hide the button when clicked
    });

    closeFormBtn.addEventListener('click', function() {
      reviewForm.classList.add('hide');
      reviewForm.classList.remove('show');
      setTimeout(() => {
        reviewForm.style.display = 'none';
        openFormBtn.style.display = 'block'; // Show the button again
      }, 500); // match the transition duration
    });

    formElement.addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent the default form submission

      // Collect form data
      const formData = new FormData(formElement);
      console.log(formData); // You can use formData as needed
      
      // Example: Display success message
      alert('Review submitted'); // Replace with your preferred method of displaying success message (e.g., toast notification)

      // Reset form or close the form
      reviewForm.classList.add('hide');
      reviewForm.classList.remove('show');
      setTimeout(() => {
        reviewForm.style.display = 'none';
        openFormBtn.style.display = 'block'; // Show the button again
      }, 500); // match the transition duration
    });
  });
</script>

{% schema %}
{
  "name": "Review Form",
  "target": "section",
  "settings": [
    { "type": "product", "id": "product", "label": "Product", "autofill": true },
    { "type": "color", "id": "colour", "label": "Star Colour", "default": "#ff0000" }
  ]
}
{% endschema %}
