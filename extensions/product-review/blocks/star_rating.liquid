<!-- Star Rating section with Review Form -->
<div class="star-rating-section">
  <h2 class="star-rating-section__title">Customer Ratings</h2>

  {% assign reviews = shop.metafields.custom.reviews %}
  {% if reviews and reviews.size > 0 %}
    <ul class="star-rating-list">
      {% for review in reviews %}
        <li class="star-rating-item">
          <h3 class="star-rating-item__title">{{ review.title }}</h3>
          <p class="star-rating-item__content">{{ review.content }}</p>
          <div class="star-rating-item__stars">
            {% for i in (1..5) %}
              {% if review.rating >= i %}
                <span class="star filled">&#9733;</span>
              {% else %}
                <span class="star">&#9734;</span>
              {% endif %}
            {% endfor %}
          </div>
          <p class="star-rating-item__author"><strong>Author:</strong> {{ review.author }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="star-rating-section__no-reviews">No reviews yet. Be the first to review!</p>
  {% endif %}

  <button class="open-review-form-btn">Write a Review</button>

  <!-- Remix Modal -->
  <div class="remix-modal">
    <div class="remix-modal__overlay"></div>
    <div class="remix-modal__content">
      <h2 class="remix-modal__title">Write a Review</h2>
      <form action="/submit_review" method="POST">
        <label for="review-title">Title</label>
        <input type="text" id="review-title" name="review[title]" required>

        <label for="review-content">Review</label>
        <textarea id="review-content" name="review[content]" required></textarea>

        <label for="review-rating">Rating</label>
        <div class="star-rating-input">
          {% for i in (1..5) %}
            <input type="radio" id="star{{ i }}" name="review[rating]" value="{{ i }}" required>
            <label for="star{{ i }}" title="{{ i }} stars">&#9733;</label>
          {% endfor %}
        </div>

        <label for="review-author">Author</label>
        <input type="text" id="review-author" name="review[author]" required>

        <button type="submit">Submit Review</button>
      </form>
      <button class="remix-modal__close-btn">Close</button>
    </div>
  </div>

  <style>
    .star-rating-section {
      padding: 20px;
      border-top: 1px solid #ccc;
      margin-top: 20px;
    }
    .star-rating-section__title {
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    .star-rating-list {
      list-style-type: none;
      padding: 0;
    }
    .star-rating-item {
      margin-bottom: 20px;
    }
    .star-rating-item__title {
      font-size: 1.2em;
      margin: 0 0 5px;
    }
    .star-rating-item__content {
      margin: 0 0 10px;
    }
    .star-rating-item__stars,
    .star-rating-input {
      display: flex;
      gap: 5px;
    }
    .star {
      font-size: 1.5em;
      color: #ccc;
    }
    .star.filled {
      color: gold;
    }
    .open-review-form-btn {
      background-color: #000000;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease;
    }
    .open-review-form-btn:hover {
      background-color: #0056b3;
    }
    .remix-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .remix-modal__overlay {
      background-color: rgba(0, 0, 0, 0.5);
      width: 100%;
      height: 100vh;
      position: absolute;
      top: 0;
      left: 0;
    }
    .remix-modal__content {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 50%;
      z-index: 10;
      position: relative;
    }
    .remix-modal__title {
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    .remix-modal__close-btn {
      background-color: #ccc;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 10px;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const openFormBtn = document.querySelector('.open-review-form-btn');
      const closeFormBtn = document.querySelector('.remix-modal__close-btn');
      const reviewForm = document.querySelector('.remix-modal');

      openFormBtn.addEventListener('click', function() {
        reviewForm.style.display = 'flex';
      });

      closeFormBtn.addEventListener('click', function() {
        reviewForm.style.display = 'none';
      });
    });
  </script>

{% schema %}
{
  "name": "Star Rating",
  "target": "section",
  "settings": [
    { "type": "product", "id": "product", "label": "Product", "autofill": true },
    { "type": "color", "id": "colour", "label": "Star Colour", "default": "#ff0000" }
  ]
}
{% endschema %}
